/*
 * MAIN.C
 *
 * Author	: Visakhan C
 * Date		: Apr 10, 2013
 *		
 */

#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

#include "ks0108.h"
#include "times_12pt.h"
#include "small_font.h"

#include "adc.h"
#include "buttons.h"
#include "menu.h"
#include "settings.h"

extern Menu MainMenu;

void init(void); 

//unsigned char sin_samples[] = { 128, 134, 140, 146, 152, 159, 165, 171, 176, 182, 188, 193, 199, 204, 209, 213, 218, 222, 226, 230, 234, 237, 240, 243, 246, 248, 250, 252, 253, 254, 255, 255, 255, 255, 255, 254, 253, 252, 250, 248, 246, 243, 240, 237, 234, 230, 226, 222, 218, 213, 209, 204, 199, 193, 188, 182, 176, 171, 165, 159, 152, 146, 140, 134, 128, 121, 115, 109, 103, 96, 90, 84, 79, 73, 67, 62, 56, 51, 46, 42, 37, 33, 29, 25, 21, 18, 15, 12, 9, 7, 5, 3, 2, 1, 0, 0, 0, 0, 0, 1, 2, 3, 5, 7, 9, 12, 15, 18, 21, 25, 29, 33, 37, 42, 46, 51, 56, 62, 67, 73, 78, 84, 90, 96, 103, 109, 115, 121 };

const uint8_t welcome_screen[] PROGMEM = {

	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,252,252,254,230,195,129,1,1,1,3,31
	, 3,0,0,0,0,128,128,192,64,64,64,192,192,64,0,0
	, 0,0,128,192,192,64,64,64,192,128,128,0,0,0,0,64
	, 64,192,192,192,192,128,128,192,192,192,192,128,0,0,0,0
	, 0,0,128,128,192,64,64,192,192,192,128,0,0,0,1,1
	, 7,31,127,255,255,241,192,192,96,49,25,15,7,3,1,1
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,192,224,0,1,3,3,7,7,143,255,254,252,56
	, 0,0,248,254,255,255,131,0,0,0,0,128,3,0,0,124
	, 254,255,255,3,0,0,0,0,225,255,255,127,28,0,0,0
	, 240,255,255,127,3,0,0,128,225,255,255,63,14,0,0,248
	, 254,255,255,137,8,12,12,7,135,135,3,0,0,0,128,192
	, 96,48,24,13,7,31,127,255,252,240,192,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,3,3,2,2,2,2,2,3,1,1,0,0,0
	, 0,0,0,1,1,3,3,3,3,3,1,0,0,0,0,0
	, 0,1,3,3,2,2,2,3,1,1,0,0,128,128,224,255
	, 255,255,135,130,2,2,3,3,1,1,0,0,0,0,0,0
	, 1,1,3,3,3,3,3,1,1,0,0,2,2,3,3,3
	, 2,0,0,0,0,2,2,3,3,3,3,3,2,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,224,32,32
	, 32,192,0,128,64,32,32,32,64,128,0,224,32,32,32,192
	, 0,0,32,32,224,32,32,0,0,128,96,96,128,0,0,224
	, 32,32,32,192,0,224,0,0,0,0,224,32,32,32,32,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,192,96,56,12,4,6,2,2,6,12,8,24,96,192,128
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	, 128,128,128,128,128,128,128,128,128,128,128,128,128,159,130,130
	, 130,129,128,135,136,144,144,144,136,135,128,159,130,130,134,137
	, 144,128,128,128,159,128,128,128,156,135,132,132,135,156,128,159
	, 145,145,145,142,128,159,144,144,144,128,159,145,145,145,144,128
	, 128,128,128,128,128,128,128,128,128,128,128,128,128,224,176,140
	, 135,129,128,128,128,128,128,128,128,128,128,128,128,128,128,131
	, 134,152,176,192,128,128,128,128,128,128,128,128,128,128,128,128
	, 128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,240,8,4
	, 4,4,8,240,0,24,36,36,36,196,0,240,8,4,4,4
	, 4,0,4,252,4,0,252,0,0,0,0,252,0,0,0,0
	, 240,8,4,4,4,8,240,0,24,36,36,36,196,0,240,8
	, 4,4,4,4,0,240,8,4,4,4,8,240,0,252,68,68
	, 68,56,0,252,36,36,36,4,0,0,0,0,0,0,0,0
	, 0,0,0,0,3,6,28,48,96,128,0,0,0,0,0,0
	, 0,0,0,0,0,128,192,112,30,3,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2
	, 2,2,1,0,0,2,2,2,2,1,0,0,1,2,2,2
	, 2,0,2,3,2,0,3,2,2,2,0,3,2,2,2,0
	, 0,1,2,2,2,1,0,0,2,2,2,2,1,0,0,1
	, 2,2,2,2,0,0,1,2,2,2,1,0,0,3,0,0
	, 0,0,0,3,2,2,2,2,0,0,0,0,0,0,0,0
	, 0,0,0,0,0,0,0,0,0,1,3,6,12,24,16,48
	, 32,32,48,24,14,3,0,0,0,0,0,0,0,0,0,0

};


int main(void) 
{
	
	init();
		
	while(1) {
	
		Do_Menu(&MainMenu);
		_delay_ms(250);
		
	}
}


void init(void)
{
	// Wait a little while the display starts up
	_delay_ms(500);
	
	// Initialize the LCD
	ks0108Init(1);
	ks0108DrawBitmap(welcome_screen);
	_delay_ms(2000);
	ks0108SelectFont(Times_12, ks0108ReadFontData, BLACK);
	Button_Init();
	Backlight_Init();
	
	// Enable global interrupt
	sei();
	
}
